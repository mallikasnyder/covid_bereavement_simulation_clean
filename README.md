# Code and data for reproducible results

This repository contains reproducible results for Snyder, Alburez-Gutierrez, Williams, and Zagheni (2022). "Estimates from 31 countries show the significant impact of COVID-19 excess mortality on the incidence of family bereavement". *PNAS*. 

This repository contains the code required to obtain the estimates from this simulation outputs and to produce the figures and estimates referenced in the paper (the .\Kin_death folder). Other folders contain input data (the .\Input folder) or store intermediate outputs (the .\Data) and figures and numerical values (.\Output) generated by the code. The .\Kin_death folder contains the following scripts and R markdown files:
* Scripts for obtaining estimates from each simulation's output and combining these files into datasets used in analysis (00_get_estimates.R and 01_get_full_dataset.R, run sequentially as Jobs in the RStudio interface)
* Scripts that contain and load functions used in these scripts (load_functions.R and functions_bereavement.R), which are not run separately, but are referenced in other scripts
* Scripts for obtaining estimates used in the SI appendix comparison of formal-based and simulation approaches to calculating female kin in Sweden (A00_finding_female_kin.R and A01_analyzing_sim_results_female.R, run sequentially)
* The R markdown document (.Rmd and .html versions) used to calculate the results referenced in the main text (results_final.Rmd)
* The R markdown document (.Rmd and .html versions) used to calculate the results used in the SI appendix to compare simulation excess mortality to that calculated directly from the input STMF data (mortality_comparison_appendix.Rmd).
* The R markdown document (.Rmd and .html versions) used to calculate the results used in the SI appendix to compare Swedish female kin counts between the formal and simulation-based approaches (compare_female_kin_appendix.Rmd).

Before running the scripts, ensure that you update the scripts to correctly reference the directories and file structure on your computer; this may depend on the operating system and directory structure being used. These estimates were calculated using R version 3.6.3 (2020-02-29) on a x86_64-pc-linux-gnu (64-bit) platform, running under Ubuntu 18.04.6 LTS.  

The simulations used in the analysis are stored separately in the OSF repository in the Simulation Outputs folder. To calculate estimates from the simulation files, download the simulation files (note that they are stored zipped, and are very large), adjust the directories as needed on your computer, and then run the estimation scripts. Note that the calculation of estimates used a multi-core server, and will likely not be possible to run on most laptops. 

Please contact Mallika Snyder (mallikasnyder@berkeley.edu) with any questions. 
